# 学习总结（2025-09-15 00:00:00 – 2025-09-23 23:59:59）

## ✅ 本周期结论
本期聚焦三大主线：**Shopify/GraphQL 业务接口栈**、**后端工程与运维（RabbitMQ/K8s/SQL/文件签名）**、**政策与投资常识复盘**。你把“如何正确定义与调用电商接口”“怎样用外部化配置覆盖代码约定”“SQL 更新/去重/排序的安全范式”“K8s 堆转储（HeapDump）落盘路径”“JPEG 文件头甄别”等关键点形成了可复用模板，并对**要素市场化改革**与**被动投资准则**进行了结构化梳理。

---

## 📚 学习要点（按主题）

### Ⅰ. Shopify / GraphQL 实战要点
- **GraphQL 基本认识**  
  - 含义：前端按需声明字段（避免 REST 过/欠取）。  
  - Shopify **Admin GraphQL** 已深度采用；你查阅了官方文档与示例。
- **Variants vs Options（变体 vs 选项）**  
  - *Option* 是“变体维度”（如 Color/Size）；*Variant* 是具体组合（如 “Red, M”）。
- **商品建改主路径**  
  - `productSet`：统一承载标题、选项、变体、状态与部分 metafields。  
  - 价格批量：`productVariantsBulkUpdate`。  
  - 库存：`inventoryAdjustQuantities`（按 location）。
- **按商品 ID 获取信息**  
  - GraphQL：`product(id: "gid://shopify/Product/<ID>") { ... }` 按需取字段（全量/部分自选）。  
- **媒体上传与挂载**  
  - 先 `fileCreate` 上传 ➜ 再把媒体附加到商品/变体（如 `productVariantAppendMedia`）。  
  - 典型报错：**“扩展名与实际格式不匹配”**（需要校验文件头/Content-Type 与扩展名一致）。
- **发布渠道（Online Store / Shop / Markets 等）**  
  - 用 `publishablePublish` / `publishableUnpublish` 控制**渠道级**上/下架；GraphiQL 仅是测试工具，不是必须环节。
- **类别与自定义属性（Metafields）**  
  - 类目映射可走 metafields（自定 namespace/key），如自定义“袖长”；多语言可配多命名空间或翻译表。

> 建议把“**构建/更新/价格/库存/媒体/发布/扩展属性**”各自用 **GraphQL 片段**封装成可复用脚手架。

---

### Ⅱ. 后端工程与运维

#### 1) RabbitMQ 配置与代码取舍
- 你确认了**外部化配置优先级**：Nacos（或 `application*.yml`）> 代码默认值。若 `RabbitMQConfig` 仅做“硬编码默认”，可移除以避免与 Nacos 冲突。  
- 监听容器参数如
  ```yaml
  spring:
    rabbitmq:
      listener:
        simple:
          acknowledge-mode: manual
          prefetch: 100
          concurrency: 2
          max-concurrency: 4

将按 **Environment** 覆盖代码；运行时以 Nacos/本地配置为准。

#### 2) K8s 中 HeapDump 落盘与收集

* JVM 参数范式：

  ```bash
  -XX:+HeapDumpOnOutOfMemoryError \
  -XX:HeapDumpPath=/heapdumps
  ```
* Pod 挂载（示例）：

  ```yaml
  volumes:
    - name: heapdump
      emptyDir: {}          # 或 PVC
  containers:
    - name: app
      volumeMounts:
        - name: heapdump
          mountPath: /heapdumps
  ```
* 要点：**可写目录**、**容量足够**、如需持久化用 **PVC**，并在 OOM 告警里链路到 dump 采集。

#### 3) SQL：更新/排序/去重范式

* **`ORDER BY DESC` 报错**：标准语法为 `ORDER BY <col> DESC`，不能单独写 `ORDER BY DESC`；多字段示例：`ORDER BY created_time DESC, id DESC`。
* **DDL vs 查询**

  * DDL：表结构/索引/约束变更；
  * 查询/写入属 DML（SELECT/INSERT/UPDATE/DELETE）。
* **集合差（联表找缺项）**

  * “不在右边”：`LEFT JOIN ... ON ... WHERE right.id IS NULL`；
  * Excel 也可用 `XLOOKUP`/`MATCH` 标记缺失项。
* **数据治理脚本**（保护条件 + 软删除）：用 `JOIN` + `NOT EXISTS` 保护“已推送/已发布”记录，只软删不硬删；关键列加索引保障可控成本。

#### 4) 文件签名（Magic Number）甄别 JPEG

* JPEG 典型文件头：`FF D8 FF E0`（或 `FF D8 FF E1` 等），文件尾：`FF D9`。
* 实务：**以文件头为准**辨识真实格式，避免“扩展名正确但内容不是 JPEG”导致的上传失败。

---

### Ⅲ. 政策与投资常识

* **要素市场化改革（政策理解）**

  * 本质：让劳动力/土地/资本/数据等要素的**价格形成、流动配置与使用效率**更多依靠市场机制，当前以试点推进（如盘活存量土地、股权份额转让机制探索）。
* **被动投资五准则（复习）**

  * **多元分散**、**被动为主**、**降低成本**、**保持恒心**、**不懂不做**。
  * 你讨论了 **生科/科技类 ETF 的加减仓**与 **2800（盈富基金，HSI）费用**等实务问题，并强调按自身认知边界行动。
* **贵金属估值口径**

  * 600g 金价估算：换算为 **troy ounce**（31.1035 g/oz），再乘当日 **spot price**；实际价值随当日金价与点差波动。

---

## 🛠️ 可复用清单（Mini-Checklist）
* **RabbitMQ / 配置优先级**

  * [ ] 尽量用 Nacos/`application*.yml` 管理参数
  * [ ] 移除仅含“硬编码默认”的配置类，避免冲突
* **K8s HeapDump**

  * [ ] `-XX:+HeapDumpOnOutOfMemoryError` + `-XX:HeapDumpPath`
  * [ ] 可写挂载（emptyDir/PVC），容量与权限校验
* **SQL 安全范式**

  * [ ] `CASE` 条件更新
  * [ ] `LEFT JOIN ... IS NULL` 差集
  * [ ] `ORDER BY <col> DESC` 语法
  * [ ] 治理脚本用软删 + 保护条件 + 必要索引
* **文件签名校验**

  * [ ] 以 Magic Number 判定实际格式（JPEG: `FFD8FF...` / 结尾 `FFD9`）
