# 学习总结（2025-08-20 00:00:00 – 2025-08-31 23:59:59）

## ✅ 本周期结论
本期你在 **数据库与表结构治理**、**消息队列与契约**、**Java/Kotlin 异常与可见性**、**构建与包管理**、**配置路径与跨平台**、以及 **文书与常识** 等方面形成了可落地的“做法清单”。重点是：用索引与约束守住数据一致性；用清晰的消费组/Topic 契约稳定消息流；用“可见性/懒加载/缓冲区语义”修正后端代码细节；同时把工具链（npm、Gradle）与跨平台路径统一成标准操作。

---

## 📚 学习要点（按主题拆分）

### 1) MySQL 表结构与索引治理
- **列默认值与约束**：确认状态列允许 `NULL`（而非一刀切 `DEFAULT 0`），并把 `created_time / revised_time` 设为非空，确保审计可用。  
- **DDL 调整注意**：新增 JSON/VARCHAR 长字段时，统一字符集/排序规则；大字段长度权衡（`VARCHAR(1000)` vs `VARCHAR(1024)`）以“**真实数据分布 + 索引需求**”决策。

### 2) RocketMQ：Topic / ConsumerGroup / 契约
- **一组一责**：同组内均衡消费；不同组实现“多方各取一遍”。一个系统监听多 Topic 时，**按职责拆组**更清晰。  
- **命名规范**：`<env>_<domain>_<entity>_<event>_topic`；消费组以“**职责**”命名，避免复用导致进度/幂等互相影响。  
- **消息契约**：固定字段（`eventType/bizId/op/ts/traceId/payload`），**版本化**并保持向后兼容。

### 3) Java/Kotlin 工程问题定位与修复
- **Kotlin 可见性错误**：`Class 'X' is exposed outside its defined visibility scope` → 调整 `internal/public` 与对外 API 的类型暴露一致；避免把内部实现类型泄露到公共签名。  
- **Jimmer `UnloadedException`**：懒加载字段未取出 → 通过 **Fetcher/Join** 预取或在查询端改为显式选择需要的关联字段。  
- **`ReadOnlyBufferException`**：`ByteBuffer.array()` 只对有 `hasArray()` 的可写缓冲有效；对只读缓冲用 `get(dst)` 拷贝或 `duplicate()/slice()` 后再读。  
- **枚举反序列化对齐**：两端枚举保持**同名同值**（或以 `code` 传输 + 本地映射），避免新增枚举破坏兼容。  
- **Javadoc 与 `@Suppress`**：`@Suppress("SpringJavaInjectionPointsAutowiringInspection")` 用于屏蔽 IDE 注入检查（静态检查），不影响运行时注入。

### 4) 构建与包管理
- **Gradle 常用操作**：清缓存/增量构建/查看依赖树/指定 profile 等形成小抄；必要时使用 `--no-daemon` 诊断构建问题。  
- **npm 全局包管理**：  
  - 查看：`npm list -g --depth=0`  
  - 卸载（含 URL 安装的包）：`npm uninstall -g <package-name>`（先用 `list -g` 确认真实包名）。

### 5) 配置与跨平台路径（Windows/macOS）
- **`spring.config.import` 本地文件**（Windows IDEA）：使用 `file:///` 规范 URI 或 `file:C:/path/to/bootstrap.yml`；包含空格时用引号或转义；环境变量占位 `${env}-${app}` 可在 VM options/Env 中注入。  
- **网关/路由命名**：服务名避免下划线（部分匹配器兼容性差），**用短横线**更稳。

### 6) 数据处理与小技巧
- **JS 对象提取**：从接口数组中提取 `dictCode`/`dictName` 映射，形成 `Map` 或下拉选项列表（`label`/`value`）。  
- **日志裁剪**：重复日志仅留一处“全量”，其他位置限制 100–200 字符摘要，结合 `traceId` 追链路，降噪提效。  

### 7) 业务实现与代码规范
- **“推送状态更新”**：新增 `updateEntity` 专用于局部字段更新，隔离写路径并保留审计字段（`reviser/revised_time`）。  
- **配置类设计**：拆子类或分前缀（如 `murmuration.aip.*`）以承载多路配置源，便于灰度与测试。

### 8) 文书与通识 
- **零碎常识**：`DICK’S Sporting Goods` 为美国大型体育/户外零售商；  
  **302AI** 了解为 LLM 聚合/网关类服务（成本评估与路由策略可作对照）。

---

## 🛠️ 速用清单（可直接复用）

- **MySQL/DDL**
  - [ ] 新增列：补注释/默认值/是否 `NOT NULL`  
  - [ ] 索引：按查询路径验证覆盖度与选择性  
  - [ ] 长字段：评估真实长度分布，避免过度放大

- **MQ 契约**
  - [ ] 规范化 Topic/Group 命名  
  - [ ] 契约字段与版本号  
  - [ ] 幂等键（主键/外部版本）与重试/退避/DLQ

- **Java/Kotlin**
  - [ ] 可见性一致性（public API 不暴露 internal 类型）  
  - [ ] 懒加载字段：Fetcher/Join 预取  
  - [ ] `ByteBuffer` 只读安全读取路径

- **构建/工具**
  - [ ] `npm list -g` → `npm uninstall -g`  
  - [ ] Gradle 依赖树/缓存清理小抄  
  - [ ] 本地 `spring.config.import` 使用标准 `file:` URI

---

## 🎯 下一步计划（可执行）
1. **落地 MQ 契约与命名规范**：梳理现有 Topic/Group，补齐版本号与幂等键；输出一页式契约文档。  
2. **修复两类后端缺陷**：为 Jimmer 懒加载路径补 Fetcher；排查 `ByteBuffer.array()` 使用点并替换为安全读法。  
3. **索引审计**：对同步/状态/分页高频表执行覆盖率与慢查询审计，必要时补复合索引。  
4. **统一配置加载**：整理跨平台 `spring.config.import` 模板，加入工程脚手架。  
5. **工具小抄入库**：把 npm/Gradle/日志裁剪等操作，固化到团队 Wiki/README。

> 如果需要，我可以把 **MQ 契约模板**、**Jimmer Fetcher 示例**、**ByteBuffer 安全读写示例** 与 **DDL 索引审计脚本** 单独整理为可复制的代码片段与检查表。
