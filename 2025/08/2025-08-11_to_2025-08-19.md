# 学习总结（2025-08-11 18:00:00 – 2025-08-19 23:59:59）

## ✅ 本周期结论
围绕 **DTS→RocketMQ→ES 同步链路**、**ES 检索与可观测性**、**SQL 去重与安全更新**、**MQ 消费组与命名规范**、以及 **AI/学习方法与安全** 展开系统梳理；同时补齐 **CDC（变更数据捕获）**、**ILM（索引生命周期）**、**回放脚本（按时间窗/offset）** 等关键概念，并沉淀了实操清单与沟通脚本。

---

## 📚 学习要点

### 1) ES 同步与检索实战（0811）
- 打通 **DTS→RocketMQ→ES** 链路并进行联调；为特定查询较慢的分页列表增加 ES 同步监听。  
- 新增 **ES 同步失败日志表**，便于重试与审计；补充 **性能测试数据生成**方法，支持批量造数与压测。  
- 为条码/商品分页补充 ES 查询与缓存策略

### 2) 数据管道术语与可观测性（0814）
- **批量写入**、**重试退避（exponential backoff）**、**DLQ（死信队列）** 明确使用场景与触发条件。  
- **指标埋点**：最低要求采集 **TPS/失败率/ES 耗时**，用于告警与容量评估。  
- **回放脚本**：按 **时间窗** 或 **offset** 精确回放消息，支撑补数与追溯。  
- **ILM（Index Lifecycle Management）**：热/温/冷分层与滚动索引策略，降低存储成本并稳态写入。

### 3) MQ 主题/消费组与契约（0815）
- **group 的作用**：同组内消费实例负载均衡；跨组实现多方独立消费。  
- **topic 命名**：按环境与业务域分层，约定使用 **下划线** 或 **短横线** 的团队规范（本项目倾向下划线）； 
- **消息契约**：固定字段（eventType、bizId、op、ts、traceId、payload），版本化治理，保持向后兼容。  
- 预研 **窗口聚合**：后续考虑将多记录变更合并，减少 ES 写放大。

### 4) 网关与负载（0815）
- Spring Cloud Gateway 路由 **服务名不要使用下划线**（避免匹配问题，推荐短横线 `-`）；  
- 负载不均主要因 **定时任务未做单点/分片** 导致，请使用 **分布式锁/Leader 选举/任务分片** 保证均衡。


### 6) CDC 与回放（0818）

* **CDC（Change Data Capture，变更数据捕获）**：基于 binlog/redo 日志实时捕获数据变更，低侵入、低延迟，适合向 ES/数据湖同步。
* 回放与补数流程：**定位时间窗 → 生成 offset/游标 → 幂等写 ES（按主键或外部版本号） → 核对指标**。

### 7) 排期评估与数据初始化（0814）

* 对 5/7/10 天排期进行理性评估：含 **DTS 建链、ES 索引/mapping/ILM、Sink Consumer、SearchService 抽象、回放/补数、测试** 等，10 天更稳妥。
* **数据初始化**：采用 **快照全量 + 增量追赶** 的模式；全量阶段控制 **批量大小/并发/刷新策略**，增量阶段依赖 CDC 保障一致性。

### 8) 方法论与阅读

* **Coding Agents 安全**（0819）

  * 关注供应链注入、工具权限边界、提示注入与数据外泄风险；构建 **最小权限工具链** 与 **沙箱**，全链路审计。
* **“我们对学习的认知可能是错的”**（0819）

  * 学习更像 **压缩与结构抽取**；重视 **主动探索** 与 **跨任务迁移**，减少死记硬背。
* **Context Engineering for AI Agents**（0814）

  * 聚焦 **上下文裁剪、检索/工具接入、记忆窗管理**，以降低幻觉与提升任务稳态。
* **Vibe Coding** 与 **第一性原理**（0814）

  * 从 **目标-约束-不可变项** 出发组织工作流；在 AI 时代把精力放到 **问题分解与验证**。
* **Fast Inverse Square Root**（0814）

  * 经典位运算近似 vs. 现代硬件指令（如 `rsqrtps`）在 **精度/可移植/维护性** 上的权衡。
* **© 与 PBC**（0814）

  * `©` 表示版权年份与主体；**PBC（公益性公司）** 兼顾商业与公共利益使命。

---

## 🛠️ 可复用清单

* **ES 写入稳态**：批量大小、刷新间隔、重试退避、DLQ、指标（TPS/失败率/耗时）
* **回放/补数**：时间窗→offset→幂等写→校验报表
* **MQ 规范**：`<env>_<domain>_<entity>_<event>_topic`；group 以 **消费者职责** 命名
* **网关/任务**：服务名用短横线、定时任务做单点/分片
* **SQL 去重**：窗口函数计算“最新一条”，再 JOIN 回写

---

## 🎯 下一步计划（可执行）

1. 给条码与商品同步链路补齐 **DLQ/回放脚本** 与 **核心指标告警**。
2. 统一 **topic/group 命名规范** 与 **消息契约**，补版本号与灰度策略。
3. 为去重场景创建 **存储过程/脚本模板**，并在关键列补充/优化索引。
4. 将本期方法论沉淀为 **Notion/Markdown 模板**（联调清单、回放步骤、告警项）。
5. 针对 Coding Agents 安全，梳理最小权限工具集与沙箱隔离清单。

---

## 参考资料（原始链接）

* Coding Agents 安全：[https://baoyu.io/translations/llms-coding-agents-security-nightmare](https://baoyu.io/translations/llms-coding-agents-security-nightmare)
* 学习认知反思：[https://baoyu.io/translations/how-ai-researchers-accidentally-discovered-that-everything-they-thought-about-learning-was-wrong](https://baoyu.io/translations/how-ai-researchers-accidentally-discovered-that-everything-they-thought-about-learning-was-wrong)
* Context Engineering：[https://manus.im/blog/Context-Engineering-for-AI-Agents-Lessons-from-Building-Manus](https://manus.im/blog/Context-Engineering-for-AI-Agents-Lessons-from-Building-Manus)

